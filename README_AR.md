# لغة البرمجة باء (B Programming Language)

باء هي لغة برمجة مصممة لدعم النحو العربي مع الحفاظ على التوافق المفاهيمي مع ميزات لغة C. تتيح للمطورين كتابة الكود باستخدام الكلمات المفتاحية والمعرفات العربية. يهدف المشروع إلى توفير سلسلة أدوات مترجم كاملة، بما في ذلك معالج مسبق، ومحلل لفظي، ومحلل نحوي، ومحلل دلالي، ومولد كود.

## الحالة الحالية (محدث 2025-01-09 - المترجم الأساسي مكتمل)

وصل مترجم لغة باء إلى معلم مهم مع اكتمال **الأولوية 4: تعريفات الدوال والاستدعاءات** في يوليو 2025. البنية التحتية الأساسية للمترجم الآن وظيفية بالكامل وجاهزة للإنتاج، وتدعم مجموعة شاملة من البنى اللغوية الشبيهة بـ C مع الكلمات المفتاحية والنحو العربي. المكونات الرئيسية وحالتها:

### الميزات الأساسية والحالة

* **نظام البناء (CMake):**
  * **معاد الهيكلة:** يستخدم الآن نهجاً معيارياً يركز على الأهداف. مكتبات المكونات (الأدوات المساعدة، الأنواع، المحلل اللفظي، المعالج المسبق، إلخ) تُبنى كمكتبات ثابتة وتُربط صراحة.
  * **البناء خارج المصدر مُفرض.**
  * **تعريفات التجميع المشتركة:** تُدار عبر مكتبة واجهة `BaaCommonSettings` (معرفة في `cmake/BaaCompilerSettings.cmake`).
  * تكامل LLVM شرطي ويُدار بواسطة مكتبة `baa_codegen`.

* **المعالج المسبق (`src/preprocessor/`):** - ✅ **جاهز للإنتاج (مكتمل 100%)**
  * يتعامل مع تضمين الملفات (`#تضمين`) مع حل المسار النسبي والقياسي، واكتشاف التضمين الدائري.
  * يدعم تعريفات الماكرو (`#تعريف`) بما في ذلك الكائنية، والشبيهة بالدالة (مع المعاملات، تحويل النص إلى سلسلة `#`, لصق الرموز `##`, المعاملات المتغيرة `وسائط_إضافية`/`__وسائط_متغيرة__`)، وإعادة المسح لنتائج التوسع.
  * فحص إعادة تعريف الماكرو متوافق مع C99 مع مقارنة ذكية.
  * يتعامل مع `#الغاء_تعريف` (إلغاء التعريف).
  * ينفذ التجميع الشرطي (`#إذا`, `#إذا_عرف`, `#إذا_لم_يعرف`, `#وإلا_إذا`, `#إلا`, `#نهاية_إذا`) مع تقييم التعبيرات.
  * يوفر ماكروات عربية معرفة مسبقاً (`__الملف__`, `__السطر__`, `__التاريخ__`, `__الوقت__`, إلخ).
  * يدعم توجيهات `#خطأ` و `#تحذير`.
  * اكتشاف ترميز ملف الإدخال (UTF-8 افتراضي، UTF-16LE مع BOM).
  * نظام استرداد خطأ شامل مع تقارير أخطاء متعددة.

* **المحلل اللفظي (`src/lexer/`):** - ✅ **جاهز للإنتاج (مكتمل 100%)**
  * يُرمز التدفق المُعالج مسبقاً UTF-16LE.
  * يدعم المعرفات العربية/الإنجليزية، الأرقام العربية-الهندية، الكلمات المفتاحية العربية.
  * يُرمز المسافات البيضاء والأسطر الجديدة وجميع أنواع التعليقات كرموز منفصلة.
  * يتعامل مع القيم الحرفية العددية مع الأرقام العربية-الهندية والبادئات والشرطات السفلية.
  * يتعامل مع السلاسل النصية والحروف مع تسلسلات الهروب العربية المخصصة لباء.
  * تتبع دقيق للخط/العمود وتقرير الأخطاء اللفظية.

* **المحلل النحوي (`src/parser/`):** - ✅ **جاهز للإنتاج (الميزات الأساسية مكتملة)**
  * ✅ **إعادة التصميم الكاملة منتهية** - محلل نحوي تنازلي تكراري حديث مع معالجة شاملة للأخطاء.
  * ✅ **الأولوية 4 مكتملة (2025-07-06)** - تعريفات الدوال والاستدعاءات منفذة بالكامل.
  * ✅ **دعم كامل للتعبيرات** - خوارزمية تسلق الأولوية مع جميع العمليات.
  * ✅ **جمل التحكم في التدفق** - If/else، while، for، return، break، continue.
  * ✅ **إعلانات المتغيرات** - محددات النوع، التهيئة، معدل const.
  * ✅ **دعم الدوال** - تعريفات دوال كاملة مع المعاملات والاستدعاءات.
  * ✅ **النحو العربي** - دعم أصلي للكلمات المفتاحية العربية في جميع أنحاء اللغة.

* **شجرة النحو المجردة (AST):** - ✅ **جاهز للإنتاج (الميزات الأساسية مكتملة)**
  * ✅ **إعادة التصميم الكاملة منتهية** - هيكل `BaaNode` موحد مع اتحاد مميز.
  * ✅ **الأولوية 4 مكتملة (2025-07-06)** - عقد الدالة والمعامل وتعبير الاستدعاء.
  * ✅ **أنواع عقد شاملة** - جميع التعبيرات والجمل والإعلانات منفذة.
  * ✅ **إدارة الذاكرة** - إنشاء قوي وتنظيف ومعالجة أخطاء.
  * ✅ **امتدادات المصدر** - تتبع موقع مصدر دقيق لجميع العقد.

* **نظام الأنواع (`src/types/`):** - *الأساسيات منفذة*
  * الأنواع الأساسية منفذة (`عدد_صحيح`, `عدد_حقيقي`, `حرف`, `منطقي`, `فراغ`).
  * قواعد فحص النوع والتحويل الأساسية معرفة.
  * دعم نوع المصفوفة (`BAA_TYPE_ARRAY`) موجود على مستوى نظام الأنواع.

* **العمليات (`src/operators/`):** - *الأساسيات منفذة*
  * تعريفات للعمليات الحسابية والمقارنة والمنطقية والتعيين.
  * جدول أولوية العمليات معرف.
  * التحقق الأساسي من النوع للعمليات.

### 🚀 القدرات الحالية (الأولوية 4 مكتملة - يوليو 2025):
* **لغة أساسية كاملة:** متغيرات، دوال، تحكم في التدفق، تعبيرات مع نحو عربي كامل
* **نظام دوال جاهز للإنتاج:** تعريفات دوال مع معاملات، استدعاءات دوال، وجمل الإرجاع
* **معالجة أخطاء قوية:** تقرير أخطاء شامل مع رسائل عربية واسترداد ذكي
* **تكامل عربي أصلي:** دعم Unicode كامل مع كلمات مفتاحية وأسماء ومسلسلات هروب عربية
* **ترميز كامل:** أرقام عربية، قيم حرفية نصية، تعليقات، وجميع البنى اللغوية

### 📋 مرحلة التطوير التالية (الأولوية 5 - مخططة):
* **نظام أنواع متقدم:** مصفوفات، هياكل، اتحادات، تعدادات، وأنواع مؤشرات
* **التحليل الدلالي:** جداول رموز، فحص نوع، حل نطاق، وتحليل تدفق التحكم
* **توليد الكود:** توليد LLVM IR، تحسين، وتوليد كود الهدف
* **المكتبة القياسية:** مكتبة قياسية عربية شاملة مع دوال I/O والرياضيات والسلاسل النصية

### 🎯 نضج المشروع:
* **المترجم الأساسي:** جاهز للإنتاج مع اختبار وتوثيق شاملين.
* **التوطين العربي:** رسائل خطأ عربية كاملة ودعم كلمات مفتاحية.
* **التوثيق:** توثيق واسع مع مراجع API وأمثلة.

### خارطة الطريق

* **الحالة الحالية (بعد اكتمال الأولوية 4):**
    1. **✅ تنفيذ المحلل النحوي وشجرة النحو المجردة مكتمل:** محلل نحوي تنازلي تكراري حديث مع نظام شجرة نحو مجردة موحد
    2. **✅ نظام الدوال مكتمل:** دعم كامل لتعريفات الدوال والمعاملات والاستدعاءات
    3. **✅ ميزات اللغة الأساسية مكتملة:** متغيرات، تحكم في التدفق، تعبيرات، وجمل
    4. **📋 جاهز للأولوية 5:** ميزات لغة متقدمة وتحليل دلالي
* **أهداف المرحلة التالية (الأولوية 5 وما بعدها):**
    1. **نظام أنواع متقدم:** تنفيذ مصفوفات، هياكل، اتحادات، تعدادات، ومؤشرات
    2. **محرك التحليل الدلالي:** جداول رموز، فحص نوع، وحل نطاق
    3. **خلفية توليد الكود:** توليد LLVM IR وتكامل التحسين
    4. **تطوير المكتبة القياسية:** دوال مكتبة قياسية عربية موطنة

## هيكل المشروع

المشروع منظم بطريقة معيارية:

```
baa/
├── cmake/                  # وحدات CMake مخصصة
├── docs/                   # التوثيق
├── include/                # ملفات الرأس العامة (منظمة حسب المكون)
│   └── baa/
├── src/                    # الكود المصدري (منظم حسب المكون)
│   ├── CMakeLists.txt      # يضيف دلائل فرعية للمكونات
│   ├── analysis/           # التحليل الدلالي وتحليل التدفق
│   ├── ast/                # تنفيذ شجرة النحو المجردة الجديدة
│   ├── codegen/            # توليد الكود
│   ├── compiler.c          # منطق المترجم الأساسي
│   ├── lexer/              # المحلل اللفظي
│   ├── main.c              # نقطة دخول الملف التنفيذي الرئيسي
│   ├── operators/          # العمليات
│   ├── parser/             # تنفيذ المحلل النحوي الجديد
│   ├── preprocessor/       # المعالج المسبق
│   ├── types/              # الأنواع
│   └── utils/              # الأدوات المساعدة
├── tests/                  # اختبارات الوحدة والتكامل
└── tools/                  # أدوات مساعدة قابلة للتنفيذ مستقلة
```

*لهيكل بصري أكثر تفصيلاً، انظر `docs/project_structure.md`.*

## التوثيق / Documentation

**متوفر باللغة / Available in:** [العربية](#البناء-من-المصدر) | [English](README.md)

### 📚 التوثيق الكامل
- **[دليل التوثيق](docs/NAVIGATION.md)** - فهرس توثيق ثنائي اللغة كامل
- **[Documentation Navigator](docs/NAVIGATION.md)** - Complete bilingual documentation index

### 🚀 روابط سريعة
- [مواصفات اللغة](docs/ar/مواصفات_اللغة.md) | [Language Specification](docs/language.md)
- [الحالة الحالية](docs/ar/ملخص_الحالة_الحالية.md) | [Current Status](docs/CURRENT_STATUS_SUMMARY.md)
- [الميزات العربية](docs/arabic_support.md) | [Arabic Features](docs/arabic_support.md)
- [المعمارية](docs/ar/نظرة_عامة_على_المعمارية.md) *(قريباً)* | [Architecture](docs/architecture.md)

## البناء من المصدر

### المتطلبات المسبقة

* CMake (3.20 أو أحدث)
* مترجم C متوافق مع C11 (يُستخدم Clang-cl لـ Windows في CI)
* Git
* (اختياري) مكتبات تطوير LLVM (للخلفية LLVM)

### خطوات البناء

**مطلوب** إجراء بناء خارج المصدر.

1. استنساخ المستودع:

    ```bash
    git clone https://github.com/OmarAglan/baa.git
    cd baa
    ```

2. إنشاء دليل بناء:

    ```bash
    mkdir build
    cd build
    ```

3. التكوين باستخدام CMake (من دليل `build`):
    * **Windows (مع Clang-cl من أدوات LLVM):**

        ```bash
        cmake -G "Ninja" -DCMAKE_C_COMPILER="C:/Program Files/LLVM/bin/clang-cl.exe" ..
        ```

        *(اضبط مسار `clang-cl.exe` حسب الحاجة.)*
    * **Linux/macOS (باستخدام مترجم C الافتراضي للنظام، مثل GCC أو Clang):**

        ```bash
        cmake -G "Ninja" ..
        ```

    * **لتمكين خلفية LLVM (إذا كان LLVM مثبتاً):**
        أضف `-DUSE_LLVM=ON` إلى أمر cmake الخاص بك. قد تحتاج `-DLLVM_DIR=/path/to/llvm/lib/cmake/llvm` إذا لم يتمكن CMake من العثور على LLVM تلقائياً.

4. بناء المشروع:

    ```bash
    cmake --build .
    # أو، إذا كنت تستخدم مولد Ninja:
    # ninja
    ```

    الملفات التنفيذية ستكون في دليل `build` (مثل `baa.exe`, `baa_lexer_tester.exe`).

### تشغيل الأدوات التنفيذية

* **اختبار المعالج المسبق:**

    ```bash
    # بعد البناء:
    ./build/tools/baa_preprocessor_tester <path/to/your/file.baa>
    ```

* **اختبار المحلل اللفظي:**

    ```bash
    # بعد البناء:
    ./build/tools/baa_lexer_tester <path/to/your/file.baa>
    ```

    (الإخراج مكتوب الآن إلى `lexer_test_output.txt` في دليل العمل الحالي)

* **اختبار المحلل النحوي (عند توفره):**

    ```bash
    # بعد البناء:
    ./build/tools/baa_parser_tester <path/to/your/file.baa>
    ```

## نقاط بارزة في اللغة (الحالية والمخططة)

* **النحو العربي:** كلمات مفتاحية، معرفات، ودعم مخطط لمزيد من البنى العربية.
* **المعالج المسبق:** ميزات متوافقة مع C99 مع توجيهات عربية.
* **نظام الأنواع:** كتابة ثابتة مع أنواع C أساسية وأسماء عربية.
* **القيم الحرفية:**
  * دعم الأرقام العربية-الهندية (`٠-٩`).
  * فاصل عشري عربي (`٫`).
  * علامة أس عربية `أ` للأعداد العشرية (تحل محل `e`/`E`).
  * لواحق عربية للأعداد الصحيحة (`غ`, `ط`, `طط`) والعشرية (`ح`).
  * تسلسلات هروب عربية مخصصة لباء (مثل `\س`, `\م`, `\يXXXX`) للسلاسل والحروف؛ الهروب على نمط C مثل `\n`, `\uXXXX` غير مدعوم.
  * تنسيقات سلاسل نصية متنوعة (عادية، متعددة الأسطر `"""..."""`, خام `خ"..."`).
* **منهي الجملة:** يستخدم `.` (نقطة) بدلاً من `;`.

### مثال برنامج

```baa
// program.baa
#تضمين <مكتبة_افتراضية_للطباعة> // افتراض مكتبة طباعة قياسية لباء

#تعريف EXIT_SUCCESS 0

// باء تستخدم إعلانات دوال على نمط C
عدد_صحيح رئيسية() {
    اطبع("!مرحباً بالعالم"). // دالة طباعة افتراضية
    إرجع EXIT_SUCCESS.
}
```

## المساهمة

المساهمات مرحب بها! يرجى الرجوع إلى `docs/development.md` لمعايير الترميز وتفاصيل نظام البناء وإرشادات تنفيذ المكونات. المجالات الرئيسية للمساهمة حالياً تشمل التحليل الدلالي وتوليد الكود.

## الرخصة

هذا المشروع مرخص تحت رخصة MIT - انظر ملف [LICENSE](LICENSE) للتفاصيل.

---

**ملاحظة:** هذا التوثيق متوفر أيضاً [بالإنجليزية](README.md).
