# Baa Language Semantic Analysis Roadmap

**Status: ğŸ“… PLANNED (Priority 5)**
**Current Focus: Design & Architecture**

This document outlines the implementation plan for the Semantic Analysis phase. This phase operates on the AST generated by the Parser (v3) and is responsible for validating the meaning of the code, type checking, and preparing for code generation.

## Phase 1: Symbol Table & Scope Management

**Goal:** Establish the infrastructure to track identifiers (variables, functions) across different scopes.

* [ ] **Symbol Table Structure:**
  * Design `BaaSymbol` struct (name, type, kind, definition location, mutable flag).
  * Design `BaaScope` struct (hash map of symbols, pointer to parent scope).
* [ ] **Scope Management:**
  * Implement `enter_scope()` and `exit_scope()`.
  * Handle Global, Function, and Block scopes.
* [ ] **Declaration Analysis:**
  * Traverse AST declarations (`VAR_DECL`, `FUNCTION_DEF`).
  * Populate symbol tables.
  * **Check:** Detect duplicate declarations in the same scope.
  * **Check:** Validate shadowing rules (warn or allow).

## Phase 2: Name Resolution

**Goal:** Link identifier usages to their declarations.

* [ ] **Identifier Resolution:**
  * Traverse expression nodes (`IDENTIFIER_EXPR`).
  * Look up symbols in the current scope stack (upwards).
  * **Check:** Report "Undeclared identifier" errors (in Arabic).
* [ ] **AST Annotation:**
  * Associate `BAA_NODE_KIND_IDENTIFIER_EXPR` nodes with their resolved `BaaSymbol`.

## Phase 3: Type Checking (Basic)

**Goal:** Ensure operations are performed on compatible types.

* [ ] **Expression Typing:**
  * Implement traversal to determine the result type of every expression.
  * **Literals:** Already have types from AST construction.
  * **Binary Ops:** Validate operands (e.g., `int + int` -> `int`). Report mismatch errors.
  * **Unary Ops:** Validate operand (e.g., `!bool` -> `bool`).
* [ ] **Assignment Validation:**
  * Ensure LHS is an L-value (assignable).
  * Ensure RHS type is compatible with LHS type.
  * **Check:** Prevent assignment to `const` (Ø«Ø§Ø¨Øª) variables.

## Phase 4: Function Semantics

**Goal:** Validate function calls and returns.

* [ ] **Call Resolution:**
  * Verify the callee exists and is a function.
  * **Check:** Argument count matches parameter count.
  * **Check:** Argument types match parameter types.
* [ ] **Return Analysis:**
  * Verify return statements exist in non-void functions.
  * **Check:** Return value type matches function declaration.

## Phase 5: Control Flow Analysis (CFA)

**Goal:** Validate logical flow of the program.

* [ ] **Unreachable Code:** Detect code after `return`, `break`, `continue`.
* [ ] **Jump Validity:**
  * Ensure `break` (ØªÙˆÙ‚Ù) and `continue` (Ø§Ø³ØªÙ…Ø±) are only inside loops.
* [ ] **Definite Assignment:** (Future) Ensure variables are initialized before use.

## Phase 6: Advanced Features (Arrays & Structs)

* [ ] **Array Semantics:**
  * Validate array size is an integer.
  * Validate index expressions are integers.
  * Check bounds (if constant).
* [ ] **Struct Semantics:**
  * Validate member access (`obj.field`).

## Integration

* **Input:** Raw AST from `baa_parse_program`.
* **Output:** Annotated AST / Symbol Table, ready for `LLVM_CODEGEN`.
* **Errors:** Use the `baa_error_reporter` system for semantic errors (e.g., "Type Mismatch").
