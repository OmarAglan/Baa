/**
 * @file ir_mem2reg.h
 * @brief تمريرة ترقية الذاكرة إلى سجلات (Mem2Reg) — إدراج فاي + إعادة تسمية SSA (v0.3.2.5.2).
 * @version 0.3.2.5.2
 *
 * هدف هذه التمريرة:
 * - ترقية المتغيرات المحلية الممثلة عبر:
 *   - `حجز` (IR_OP_ALLOCA)
 *   - `حمل` (IR_OP_LOAD)
 *   - `خزن` (IR_OP_STORE)
 *   إلى استعمال سجلات SSA مباشرة.
 *
 * هذا الإصدار ينفّذ Mem2Reg بالطريقة القياسية:
 * - حساب المسيطرات وحدود السيطرة.
 * - إدراج عقد `فاي` (IR_OP_PHI) عند نقاط الدمج.
 * - إعادة التسمية في SSA لإزالة `حمل/خزن` وتحويلها إلى قيم SSA مباشرة.
 *
 * قيود السلامة (الصحة أولاً):
 * - نُرقّي فقط `alloca` الذي:
 *   - لا يهرب مؤشّره: لا يُمرَّر إلى `نداء` ولا يُستخدم كقيمة داخل `فاي`
 *     ولا يُخزَّن المؤشر نفسه كقيمة.
 *   - كتلة تعريف المؤشر (الكتلة التي تحتوي `حجز`) تسيطر على كل استعمالات المؤشر
 *     دون استثناء لضمان صحة الـ SSA ومنع القراءة غير المهيّأة.
 *   - يوجد خزن تهيئة داخل نفس كتلة `حجز` قبل أي `حمل` لنفس المؤشر.
 */

#ifndef BAA_IR_MEM2REG_H
#define BAA_IR_MEM2REG_H

#include <stdbool.h>

#include "ir.h"
#include "ir_pass.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief تشغيل تمريرة Mem2Reg على وحدة IR كاملة.
 *
 * @param module وحدة IR الهدف.
 * @return قيمة منطقية: 1 إذا تم تعديل الـ IR، وإلا 0.
 */
bool ir_mem2reg_run(IRModule* module);

/**
 * @brief واصف تمريرة Mem2Reg لاستخدامه ضمن خط أنابيب المُحسِّن.
 */
extern IRPass IR_PASS_MEM2REG;

#ifdef __cplusplus
}
#endif

#endif // BAA_IR_MEM2REG_H
